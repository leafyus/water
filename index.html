<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nutrient Tracker</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      --radius: 0.5rem;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    
    body {
      background-color: #f8fafc;
      color: var(--gray-800);
      line-height: 1.5;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 1rem;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      border-bottom: 1px solid var(--gray-200);
      margin-bottom: 2rem;
    }
    
    h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gray-900);
    }
    
    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid var(--gray-200);
    }
    
    .tab {
      padding: 0.75rem 1rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-weight: 500;
    }
    
    .tab.active {
      border-bottom: 2px solid var(--primary);
      color: var(--primary);
    }
    
    .panel {
      display: none;
    }
    
    .panel.active {
      display: block;
    }
    
    .card {
      background-color: white;
      border-radius: var(--radius);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--gray-700);
    }
    
    input, select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius);
      background-color: white;
      font-size: 1rem;
    }
    
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: var(--primary-dark);
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    
    .progress-container {
      margin-bottom: 0.5rem;
    }
    
    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.25rem;
    }
    
    .progress-bar {
      height: 0.75rem;
      background-color: var(--gray-200);
      border-radius: 1rem;
      overflow: hidden;
    }
    
    .progress-value {
      height: 100%;
      background-color: var(--primary);
      transition: width 0.3s ease;
    }
    
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .summary-card {
      background-color: white;
      border-radius: var(--radius);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      text-align: center;
    }
    
    .summary-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.25rem;
    }
    
    .summary-label {
      font-size: 0.875rem;
      color: var(--gray-700);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--gray-200);
    }
    
    th {
      font-weight: 500;
      color: var(--gray-700);
    }
    
    tr:hover {
      background-color: var(--gray-100);
    }
    
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .calendar-title {
      font-weight: 600;
      font-size: 1.25rem;
    }
    
    .calendar-nav {
      display: flex;
      gap: 0.5rem;
    }
    
    .calendar-nav button {
      padding: 0.5rem;
      background-color: white;
      color: var(--gray-800);
      border: 1px solid var(--gray-300);
    }
    
    .weekday {
      text-align: center;
      font-weight: 500;
      color: var(--gray-700);
      padding: 0.5rem;
    }
    
    .day {
      aspect-ratio: 1/1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: white;
      border-radius: var(--radius);
      border: 1px solid var(--gray-200);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .day:hover {
      border-color: var(--primary);
    }
    
    .day.selected {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .day.today {
      font-weight: 700;
      border-color: var(--primary);
    }
    
    .day-number {
      font-size: 1.125rem;
      font-weight: 500;
    }
    
    .day-data {
      margin-top: 0.25rem;
      font-size: 0.75rem;
      text-align: center;
    }
    
    .day-indicator {
      position: absolute;
      bottom: 4px;
      display: flex;
      gap: 3px;
    }
    
    .indicator {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    
    .water-indicator {
      background-color: #3b82f6;
    }
    
    .protein-indicator {
      background-color: #10b981;
    }
    
    .chart-container {
      height: 300px;
      margin-bottom: 2rem;
    }
    
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
      .calendar {
        gap: 0.25rem;
      }
      .day-number {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Nutrient Tracker</h1>
      <button id="settings-btn">Settings</button>
    </header>
    
    <div class="tabs">
      <div class="tab active" data-tab="dashboard">Dashboard</div>
      <div class="tab" data-tab="tracker">Log Entry</div>
      <div class="tab" data-tab="history">History</div>
      <div class="tab" data-tab="trends">Trends</div>
    </div>
    
    <div id="dashboard" class="panel active">
      <div class="summary-cards">
        <div class="summary-card">
          <div class="summary-value" id="today-water">0ml</div>
          <div class="summary-label">Today's Water</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="today-protein">0g</div>
          <div class="summary-label">Today's Protein</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="avg-water">0ml</div>
          <div class="summary-label">Weekly Avg Water</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="avg-protein">0g</div>
          <div class="summary-label">Weekly Avg Protein</div>
        </div>
      </div>
      
      <div class="card">
        <h2>Today's Progress</h2>
        <div class="progress-container">
          <div class="progress-label">
            <span>Water Intake</span>
            <span id="water-progress-text">0/3000 ml</span>
          </div>
          <div class="progress-bar">
            <div class="progress-value" id="water-progress-bar" style="width: 0%;"></div>
          </div>
        </div>
        
        <div class="progress-container">
          <div class="progress-label">
            <span>Protein Intake</span>
            <span id="protein-progress-text">0/160 g</span>
          </div>
          <div class="progress-bar">
            <div class="progress-value" id="protein-progress-bar" style="width: 0%;"></div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="calendar-header">
          <div class="calendar-title" id="calendar-month">March 2025</div>
          <div class="calendar-nav">
            <button id="prev-month">&lt;</button>
            <button id="next-month">&gt;</button>
          </div>
        </div>
        
        <div class="calendar" id="calendar">
          <!-- Weekday headers -->
          <div class="weekday">Sun</div>
          <div class="weekday">Mon</div>
          <div class="weekday">Tue</div>
          <div class="weekday">Wed</div>
          <div class="weekday">Thu</div>
          <div class="weekday">Fri</div>
          <div class="weekday">Sat</div>
          
          <!-- Calendar days will be generated by JavaScript -->
        </div>
      </div>
    </div>
    
    <div id="tracker" class="panel">
      <div class="card">
        <h2>Log Daily Intake</h2>
        <form id="log-form">
          <div class="form-group">
            <label for="log-date">Date</label>
            <input type="date" id="log-date" required>
          </div>
          
          <div class="grid">
            <div class="form-group">
              <label for="water-intake">Water Intake (ml)</label>
              <input type="number" id="water-intake" min="0" step="50" placeholder="e.g. 2000">
            </div>
            
            <div class="form-group">
              <label for="protein-intake">Protein Intake (g)</label>
              <input type="number" id="protein-intake" min="0" step="1" placeholder="e.g. 120">
            </div>
          </div>
          
          <div class="form-group">
            <label for="notes">Notes (optional)</label>
            <input type="text" id="notes" placeholder="Any notes about today's intake">
          </div>
          
          <button type="submit">Save Entry</button>
        </form>
      </div>
      
      <div class="card">
        <h2>Quick Add</h2>
        <div class="grid">
          <div class="form-group">
            <label for="quick-water">Add Water (ml)</label>
            <input type="number" id="quick-water" min="0" step="50" placeholder="e.g. 250">
            <button id="add-water" style="margin-top: 0.5rem; width: 100%;">+ Add Water</button>
          </div>
          
          <div class="form-group">
            <label for="quick-protein">Add Protein (g)</label>
            <input type="number" id="quick-protein" min="0" step="1" placeholder="e.g. 20">
            <button id="add-protein" style="margin-top: 0.5rem; width: 100%;">+ Add Protein</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="history" class="panel">
      <div class="card">
        <h2>Intake History</h2>
        <div class="form-group">
          <label for="history-month">Select Month</label>
          <select id="history-month">
            <!-- Months will be populated by JavaScript -->
          </select>
        </div>
        
        <table id="history-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Water (ml)</th>
              <th>Protein (g)</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="history-body">
            <!-- History entries will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
    
    <div id="trends" class="panel">
      <div class="card">
        <h2>Water Intake Trends</h2>
        <div class="chart-container">
          <svg id="water-chart" width="100%" height="100%">
            <!-- Water chart will be generated by JavaScript -->
          </svg>
        </div>
      </div>
      
      <div class="card">
        <h2>Protein Intake Trends</h2>
        <div class="chart-container">
          <svg id="protein-chart" width="100%" height="100%">
            <!-- Protein chart will be generated by JavaScript -->
          </svg>
        </div>
      </div>
    </div>
  </div>

  <script>
    // State management
    const state = {
      entries: JSON.parse(localStorage.getItem('nutrientTrackerData')) || {},
      settings: JSON.parse(localStorage.getItem('nutrientTrackerSettings')) || {
        waterGoal: 3000,
        proteinGoal: 160
      },
      currentDate: new Date(),
      selectedDate: new Date(),
      currentMonth: new Date(),
      selectedMonth: new Date().toISOString().slice(0, 7) // YYYY-MM format
    };
    
    // Utility functions
    function formatDate(date) {
      return date.toISOString().split('T')[0]; // YYYY-MM-DD
    }
    
    function formatDisplayDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    }
    
    function saveData() {
      localStorage.setItem('nutrientTrackerData', JSON.stringify(state.entries));
    }
    
    function saveSettings() {
      localStorage.setItem('nutrientTrackerSettings', JSON.stringify(state.settings));
    }
    
    function getEntryForDate(date) {
      const dateKey = typeof date === 'string' ? date : formatDate(date);
      return state.entries[dateKey] || { water: 0, protein: 0, notes: '' };
    }
    
    function updateEntry(date, data) {
      const dateKey = typeof date === 'string' ? date : formatDate(date);
      state.entries[dateKey] = {
        ...getEntryForDate(dateKey),
        ...data
      };
      saveData();
      updateUI();
    }
    
    // UI Management
    function updateUI() {
      updateDashboard();
      updateCalendar();
      updateHistory();
      updateTrends();
    }
    
    function updateDashboard() {
      const today = formatDate(state.currentDate);
      const todayEntry = getEntryForDate(today);
      
      // Update today's values
      document.getElementById('today-water').textContent = `${todayEntry.water}ml`;
      document.getElementById('today-protein').textContent = `${todayEntry.protein}g`;
      
      // Update progress bars
      const waterPercent = Math.min(100, (todayEntry.water / state.settings.waterGoal) * 100);
      const proteinPercent = Math.min(100, (todayEntry.protein / state.settings.proteinGoal) * 100);
      
      document.getElementById('water-progress-bar').style.width = `${waterPercent}%`;
      document.getElementById('water-progress-text').textContent = `${todayEntry.water}/${state.settings.waterGoal} ml`;
      
      document.getElementById('protein-progress-bar').style.width = `${proteinPercent}%`;
      document.getElementById('protein-progress-text').textContent = `${todayEntry.protein}/${state.settings.proteinGoal} g`;
      
      // Calculate weekly averages
      const today = new Date();
      let waterTotal = 0;
      let proteinTotal = 0;
      let dayCount = 0;
      
      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const entry = getEntryForDate(formatDate(date));
        
        if (entry.water > 0 || entry.protein > 0) {
          waterTotal += entry.water;
          proteinTotal += entry.protein;
          dayCount++;
        }
      }
      
      const avgWater = dayCount > 0 ? Math.round(waterTotal / dayCount) : 0;
      const avgProtein = dayCount > 0 ? Math.round(proteinTotal / dayCount) : 0;
      
      document.getElementById('avg-water').textContent = `${avgWater}ml`;
      document.getElementById('avg-protein').textContent = `${avgProtein}g`;
    }
    
    function updateCalendar() {
      const year = state.currentMonth.getFullYear();
      const month = state.currentMonth.getMonth();
      
      // Update calendar month title
      document.getElementById('calendar-month').textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
      
      // Clear previous calendar days
      const calendarDays = document.querySelectorAll('.day');
      calendarDays.forEach(day => day.remove());
      
      // Get first day of month and total days
      const firstDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month + 1, 0).getDate();
      
      // Add empty placeholder days
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        document.getElementById('calendar').appendChild(emptyDay);
      }
      
      // Add calendar days
      for (let day = 1; day <= lastDate; day++) {
        const dateObj = new Date(year, month, day);
        const dateStr = formatDate(dateObj);
        const entry = getEntryForDate(dateStr);
        
        const dayElement = document.createElement('div');
        dayElement.className = 'day';
        dayElement.dataset.date = dateStr;
        
        if (dateStr === formatDate(state.currentDate)) {
          dayElement.classList.add('today');
        }
        
        if (dateStr === formatDate(state.selectedDate)) {
          dayElement.classList.add('selected');
        }
        
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        dayElement.appendChild(dayNumber);
        
        // Add indicators for logged data
        if (entry.water > 0 || entry.protein > 0) {
          const indicatorContainer = document.createElement('div');
          indicatorContainer.className = 'day-indicator';
          
          if (entry.water > 0) {
            const waterIndicator = document.createElement('div');
            waterIndicator.className = 'indicator water-indicator';
            indicatorContainer.appendChild(waterIndicator);
          }
          
          if (entry.protein > 0) {
            const proteinIndicator = document.createElement('div');
            proteinIndicator.className = 'indicator protein-indicator';
            indicatorContainer.appendChild(proteinIndicator);
          }
          
          dayElement.appendChild(indicatorContainer);
        }
        
        dayElement.addEventListener('click', () => {
          // Update selected date
          state.selectedDate = new Date(dateStr);
          
          // Update form date
          document.getElementById('log-date').value = dateStr;
          
          // Switch to tracker tab
          switchTab('tracker');
          
          // Update calendar
          updateCalendar();
        });
        
        document.getElementById('calendar').appendChild(dayElement);
      }
    }
    
    function updateHistory() {
      // Populate months dropdown
      const monthSelect = document.getElementById('history-month');
      monthSelect.innerHTML = '';
      
      const months = {};
      Object.keys(state.entries).forEach(dateStr => {
        const yearMonth = dateStr.substring(0, 7);
        months[yearMonth] = true;
      });
      
      // Add current month if no entries exist
      const currentYearMonth = formatDate(state.currentDate).substring(0, 7);
      months[currentYearMonth] = true;
      
      // Sort months in descending order
      const sortedMonths = Object.keys(months).sort((a, b) => b.localeCompare(a));
      
      sortedMonths.forEach(yearMonth => {
        const option = document.createElement('option');
        option.value = yearMonth;
        
        const date = new Date(yearMonth + '-01');
        option.textContent = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        
        if (yearMonth === state.selectedMonth) {
          option.selected = true;
        }
        
        monthSelect.appendChild(option);
      });
      
      // Populate history table
      const historyBody = document.getElementById('history-body');
      historyBody.innerHTML = '';
      
      const yearMonth = state.selectedMonth;
      const entriesForMonth = Object.keys(state.entries)
        .filter(dateStr => dateStr.startsWith(yearMonth))
        .sort((a, b) => b.localeCompare(a));
      
      entriesForMonth.forEach(dateStr => {
        const entry = state.entries[dateStr];
        const row = document.createElement('tr');
        
        const dateCell = document.createElement('td');
        dateCell.textContent = formatDisplayDate(dateStr);
        row.appendChild(dateCell);
        
        const waterCell = document.createElement('td');
        waterCell.textContent = `${entry.water} ml`;
        row.appendChild(waterCell);
        
        const proteinCell = document.createElement('td');
        proteinCell.textContent = `${entry.protein} g`;
        row.appendChild(proteinCell);
        
        const notesCell = document.createElement('td');
        notesCell.textContent = entry.notes || '-';
        row.appendChild(notesCell);
        
        const actionsCell = document.createElement('td');
        const editButton = document.createElement('button');
        editButton.textContent = 'Edit';
        editButton.style.padding = '0.25rem 0.5rem';
        editButton.style.fontSize = '0.875rem';
        
        editButton.addEventListener('click', () => {
          document.getElementById('log-date').value = dateStr;
          document.getElementById('water-intake').value = entry.water;
          document.getElementById('protein-intake').value = entry.protein;
          document.getElementById('notes').value = entry.notes || '';
          
          switchTab('tracker');
        });
        
        actionsCell.appendChild(editButton);
        row.appendChild(actionsCell);
        
        historyBody.appendChild(row);
      });
      
      // Show message if no entries
      if (entriesForMonth.length === 0) {
        const row = document.createElement('tr');
        const emptyCell = document.createElement('td');
        emptyCell.colSpan = 5;
        emptyCell.textContent = 'No entries for this month';
        emptyCell.style.textAlign = 'center';
        emptyCell.style.padding = '2rem';
        row.appendChild(emptyCell);
        historyBody.appendChild(row);
      }
    }
    
    function updateTrends() {
      drawWaterChart();
      drawProteinChart();
    }
    
    function drawWaterChart() {
      const svgElement = document.getElementById('water-chart');
      svgElement.innerHTML = '';
      
      // Get last 30 days of data
      const dates = [];
      const waterData = [];
      
      for (let i = 29; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = formatDate(date);
        const entry = getEntryForDate(dateStr);
        
        dates.push(dateStr);
        waterData.push(entry.water);
      }
      
      // Chart dimensions
      const svg = d3.select('#water-chart');
      const margin = {top: 20, right: 30, bottom: 40, left: 60};
      const width = svgElement.clientWidth - margin.left - margin.right;
      const height = svgElement.clientHeight - margin.top - margin.bottom;
      
      const g = svg.append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);
      
      // X axis
      const x = d3.scaleBand()
        .domain(dates.map((d, i) => i % 5 === 0 ? d.slice(5) : ''))
        .range([0, width])
        .padding(0.1);
      
      g.append('g')
        .attr('transform', `translate(0,${height})`)
        .call(d3.axisBottom(x))
        .selectAll('text')
        .style('text-anchor', 'end')
        .attr('dx', '-.8em')
        .attr('dy', '.15em')
        .attr('transform', 'rotate(-45)');
      
      // Y axis
      const maxWater = Math.max(state.settings.waterGoal, ...waterData) * 1.1;
      const y = d3.scaleLinear()
        .domain([0, maxWater])
        .range([height, 0]);
      
      g.append('g')
        .call(d3.axisLeft(y));
      
      // Goal line
      g.append('line')
        .attr('x1', 0)
        .attr('y1', y(state.settings.waterGoal))
        .attr('x2', width)
        .attr('y2', y(state.settings.waterGoal))
        .attr('stroke', '#f59e0b')
        .attr('stroke-dasharray', '4')
        .attr('stroke-width', 2);
      
      // Bars
      g.selectAll('.bar')
        .data(waterData)
        .enter().append('rect')
        .attr('class', 'bar')
        .attr('x', (d, i) => x(dates[i].slice(5)))
        .attr('y', d => y(d))
        .attr('width', x.bandwidth())
        .attr('height', d => height - y(d))
        .attr('fill', '#3b82f6');
      
      // Labels
      g.append('text')
        .attr('x', -height/2)
        .attr('y', -40)
        .attr('transform', 'rotate(-90)')
        .attr('text-anchor', 'middle')
        .text('Water Intake (ml)');
      
      g.append('text')
        .attr('x', width / 2)
        .attr('y', height + 40)
        .attr('text-anchor', 'middle')
        .text('Date (MM-DD)');
    }
    
    function drawProteinChart() {
      const svgElement = document.getElementById('protein-chart');
      svgElement.innerHTML = '';
      
      // Get last 30 days of data
      const dates = [];
      const proteinData = [];
      
      for (let i = 29; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = formatDate(date);
        const entry = getEntryForDate(dateStr);
        
        dates.push(dateStr);
        proteinData.push(entry.protein);
      }
      
      // Chart dimensions
      const svg = d3.select('#protein-chart');
      const margin = {top: 20, right: 30, bottom: 40, left: 60};
      const width = svgElement.clientWidth - margin.left - margin.right;
      const height = svgElement.clientHeight - margin.top - margin.bottom;
      
      const g = svg.append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);
      
      // X axis
      const x = d3.scaleBand()
        .domain(dates.map((d, i) => i % 5 === 0 ?
